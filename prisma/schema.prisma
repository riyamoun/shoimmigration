// This is your Prisma schema file.
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
}

model Lead {
  id            String   @id @default(cuid())
  name          String
  email         String
  phone         String
  visaType      String   // Student, PR, Work, Tourist
  targetCountry String
  message       String?
  status        String   @default("PENDING") // PENDING, CONTACTED, CLOSED
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([email])
  @@index([status])
  @@index([createdAt])
}

model User {
  id                String    @id @default(cuid())
  email             String    @unique
  password          String
  name              String?
  role              String    @default("AGENT") // ADMIN, AGENT
  resetToken        String?   @unique
  resetTokenExpiry  DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  applications      Application[]
}

model Application {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id])
  visaType        String
  targetCountry   String
  status          String   @default("SUBMITTED") // SUBMITTED, DOCUMENTS_PENDING, UNDER_REVIEW, LODGED, APPROVED, REJECTED
  stage           Int      @default(1)
  notes           String?
  documents       Document[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@index([status])
}

model Document {
  id            String      @id @default(cuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  name          String
  type          String      // passport, educational, employment, etc.
  url           String?
  status        String      @default("PENDING") // PENDING, UPLOADED, VERIFIED, REJECTED
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([applicationId])
}
